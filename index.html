<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Home Inventory System</title>
    <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        * {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'Helvetica Neue', sans-serif;
        }

        @keyframes slide-in {
            from {
                transform: translateX(100%);
                opacity: 0;
            }

            to {
                transform: translateX(0);
                opacity: 1;
            }
        }

        @keyframes fade-in {
            from {
                opacity: 0;
            }

            to {
                opacity: 1;
            }
        }

        @keyframes bounce-in {
            0% {
                transform: scale(0.95);
                opacity: 0;
            }

            50% {
                transform: scale(1.02);
            }

            100% {
                transform: scale(1);
                opacity: 1;
            }
        }

        @keyframes float {

            0%,
            100% {
                transform: translateY(0px);
            }

            50% {
                transform: translateY(-6px);
            }
        }

        @keyframes glow-shift {

            0%,
            100% {
                filter: drop-shadow(0 0 20px rgba(139, 92, 246, 0.4));
            }

            50% {
                filter: drop-shadow(0 0 30px rgba(236, 72, 153, 0.5));
            }
        }

        .animate-slide-in {
            animation: slide-in 0.4s cubic-bezier(0.34, 1.56, 0.64, 1);
        }

        .animate-fade-in {
            animation: fade-in 0.4s ease-out;
        }

        .animate-bounce-in {
            animation: bounce-in 0.5s cubic-bezier(0.34, 1.56, 0.64, 1);
        }

        .animate-float {
            animation: float 3s ease-in-out infinite;
        }

        .animate-glow {
            animation: glow-shift 3s ease-in-out infinite;
        }

        .glass-effect {
            background: rgba(255, 255, 255, 0.25);
            backdrop-filter: blur(40px);
            -webkit-backdrop-filter: blur(40px);
            border: 1.5px solid rgba(255, 255, 255, 0.4);
        }

        .glass-effect-colored {
            backdrop-filter: blur(40px);
            -webkit-backdrop-filter: blur(40px);
            border: 1.5px solid rgba(255, 255, 255, 0.3);
        }

        body {
            background: linear-gradient(135deg, #0f0f1f 0%, #1a0f2e 25%, #2d1b4e 50%, #1a0f2e 75%, #0f0f1f 100%);
            background-attachment: fixed;
            color: #fff;
            position: relative;
            overflow-x: hidden;
        }

        body::before {
            content: '';
            position: fixed;
            inset: 0;
            background: radial-gradient(circle at 20% 50%, rgba(236, 72, 153, 0.15) 0%, transparent 50%),
                radial-gradient(circle at 80% 20%, rgba(139, 92, 246, 0.15) 0%, transparent 50%),
                radial-gradient(circle at 50% 80%, rgba(59, 130, 246, 0.1) 0%, transparent 50%);
            pointer-events: none;
            z-index: 0;
        }

        #root {
            position: relative;
            z-index: 1;
        }

        .inside-items-list li {
            margin-left: 0.25rem;
            line-height: 1.4;
        }

        button {
            border: none;
            outline: none;
        }

        /* Custom scrollbar */
        ::-webkit-scrollbar {
            width: 10px;
            height: 10px;
        }

        ::-webkit-scrollbar-track {
            background: rgba(255, 255, 255, 0.05);
        }

        ::-webkit-scrollbar-thumb {
            background: linear-gradient(135deg, #ec4899, #8b5cf6);
            border-radius: 5px;
            border: 2px solid rgba(255, 255, 255, 0.1);
        }

        ::-webkit-scrollbar-thumb:hover {
            background: linear-gradient(135deg, #db2777, #7c3aed);
        }
    </style>
</head>

<body>
    <div id="root"></div>
    <!-- Debug: show JS runtime errors in-page to help diagnose blank screen -->
    <div id="__error_overlay__" style="position:fixed;inset:0;pointer-events:none;z-index:99999;">
    </div>
    <script>
        (function () {
            function showError(msg) {
                try {
                    var overlay = document.getElementById('__error_overlay__');
                    overlay.innerHTML = '';
                    var box = document.createElement('div');
                    box.style.pointerEvents = 'auto';
                    box.style.position = 'fixed';
                    box.style.left = '16px';
                    box.style.right = '16px';
                    box.style.top = '16px';
                    box.style.padding = '18px';
                    box.style.background = 'rgba(255,255,255,0.98)';
                    box.style.border = '2px solid #ff4d4f';
                    box.style.color = '#111';
                    box.style.fontFamily = 'system-ui,Segoe UI,Roboto,Arial';
                    box.style.fontSize = '14px';
                    box.style.borderRadius = '10px';
                    box.style.boxShadow = '0 10px 30px rgba(0,0,0,0.2)';
                    var pre = document.createElement('pre');
                    pre.style.whiteSpace = 'pre-wrap';
                    pre.style.margin = '0';
                    pre.textContent = msg;
                    var close = document.createElement('button');
                    close.textContent = 'Close';
                    close.style.marginTop = '8px';
                    close.onclick = function () { overlay.innerHTML = ''; };
                    box.appendChild(pre);
                    box.appendChild(close);
                    overlay.appendChild(box);
                } catch (e) { console.error('showError failed', e); }
            }

            window.addEventListener('error', function (e) {
                var msg = 'Error: ' + (e && e.message ? e.message : String(e));
                if (e && e.filename) msg += '\nFile: ' + e.filename + ':' + e.lineno + ':' + e.colno;
                if (e && e.error && e.error.stack) msg += '\nStack:\n' + e.error.stack;
                showError(msg);
                console.error(e.error || e);
            });

            window.addEventListener('unhandledrejection', function (ev) {
                var reason = ev && ev.reason ? ev.reason : ev;
                var msg = 'Unhandled Rejection: ' + (reason && reason.message ? reason.message : String(reason));
                if (reason && reason.stack) msg += '\nStack:\n' + reason.stack;
                showError(msg);
                console.error('UnhandledRejection', reason);
            });

            // Optional: catch synchronous exceptions from React render
            if (window.ReactDOM && typeof window.ReactDOM.render === 'function') {
                var oldRender = window.ReactDOM.render;
                window.ReactDOM.render = function () {
                    try {
                        return oldRender.apply(this, arguments);
                    } catch (err) {
                        showError('React render error:\n' + (err && err.stack ? err.stack : String(err)));
                        throw err;
                    }
                };
            }
        })();
    </script>

    <script type="text/babel">
        const { useState, useEffect } = React;

        // Icons
        const Search = ({ size = 24, className = "" }) => (
            <svg width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className}>
                <circle cx="11" cy="11" r="8"></circle>
                <path d="m21 21-4.35-4.35"></path>
            </svg>
        );

        const Plus = ({ size = 24, className = "" }) => (
            <svg width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className}>
                <line x1="12" y1="5" x2="12" y2="19"></line>
                <line x1="5" y1="12" x2="19" y2="12"></line>
            </svg>
        );

        const Edit2 = ({ size = 24, className = "" }) => (
            <svg width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className}>
                <path d="M17 3a2.828 2.828 0 1 1 4 4L7.5 20.5 2 22l1.5-5.5L17 3z"></path>
            </svg>
        );

        const Trash2 = ({ size = 24, className = "" }) => (
            <svg width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className}>
                <polyline points="3 6 5 6 21 6"></polyline>
                <path d="M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2"></path>
            </svg>
        );

        const Home = ({ size = 24, className = "" }) => (
            <svg width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className}>
                <path d="m3 9 9-7 9 7v11a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2z"></path>
                <polyline points="9 22 9 12 15 12 15 22"></polyline>
            </svg>
        );

        const Package = ({ size = 24, className = "" }) => (
            <svg width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className}>
                <line x1="16.5" y1="9.4" x2="7.5" y2="4.21"></line>
                <path d="M21 16V8a2 2 0 0 0-1-1.73l-7-4a2 2 0 0 0-2 0l-7 4A2 2 0 0 0 3 8v8a2 2 0 0 0 1 1.73l7 4a2 2 0 0 0 2 0l7-4A2 2 0 0 0 21 16z"></path>
                <polyline points="3.27 6.96 12 12.01 20.73 6.96"></polyline>
                <line x1="12" y1="22.08" x2="12" y2="12"></line>
            </svg>
        );

        const X = ({ size = 24, className = "" }) => (
            <svg width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className}>
                <line x1="18" y1="6" x2="6" y2="18"></line>
                <line x1="6" y1="6" x2="18" y2="18"></line>
            </svg>
        );

        const MapPin = ({ size = 24, className = "" }) => (
            <svg width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className}>
                <path d="M21 10c0 7-9 13-9 13s-9-6-9-13a9 9 0 0 1 18 0z"></path>
                <circle cx="12" cy="10" r="3"></circle>
            </svg>
        );

        const Archive = ({ size = 24, className = "" }) => (
            <svg width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className}>
                <polyline points="21 8 21 21 3 21 3 8"></polyline>
                <rect x="1" y="3" width="22" height="5"></rect>
                <line x1="10" y1="12" x2="14" y2="12"></line>
            </svg>
        );

        const Tag = ({ size = 24, className = "" }) => (
            <svg width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className}>
                <path d="M20.59 13.41l-7.17 7.17a2 2 0 0 1-2.83 0L2 12V2h10l8.59 8.59a2 2 0 0 1 0 2.82z"></path>
                <line x1="7" y1="7" x2="7.01" y2="7"></line>
            </svg>
        );

        const ChevronRight = ({ size = 24, className = "" }) => (
            <svg width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className}>
                <polyline points="9 18 15 12 9 6"></polyline>
            </svg>
        );

        const ArrowLeft = ({ size = 24, className = "" }) => (
            <svg width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className}>
                <line x1="19" y1="12" x2="5" y2="12"></line>
                <polyline points="12 19 5 12 12 5"></polyline>
            </svg>
        );

        const API_BASE_URL = window.location.hostname === 'localhost' || window.location.hostname === '127.0.0.1'
            ? 'http://127.0.0.1:8001'
            : 'https://home-inventory-production.up.railway.app';

        const getAuthHeaders = (isJson = true) => {
            const token = localStorage.getItem('access_token');
            const headers = {};
            if (isJson) headers['Content-Type'] = 'application/json';
            if (token) headers['Authorization'] = `Bearer ${token}`;
            return headers;
        };

        function HomeInventoryApp() {
            const [isAuthenticated, setIsAuthenticated] = useState(!!localStorage.getItem('access_token'));
            const [items, setItems] = useState([]);
            const [rooms, setRooms] = useState([]);
            const [categories, setCategories] = useState([]);
            const [searchTerm, setSearchTerm] = useState('');
            const [searchResults, setSearchResults] = useState([]);
            const [showAddItem, setShowAddItem] = useState(false);
            const [editingItem, setEditingItem] = useState(null);
            const [activeTab, setActiveTab] = useState('search');
            const [viewMode, setViewMode] = useState('all'); // 'all', 'rooms', 'categories', 'room-detail', 'category-detail'
            const [selectedRoom, setSelectedRoom] = useState(null);
            const [selectedCategory, setSelectedCategory] = useState(null);
            const [filteredItems, setFilteredItems] = useState([]);
            const [notification, setNotification] = useState(null);
            const [stats, setStats] = useState({ total: 0, categories: {} });

            const [itemForm, setItemForm] = useState({
                name: '',
                category: '',
                room: '',
                cupboard: '',
                shelf: '',
                loft: '',
                inside_items: '',
                notes: '',
                image_name: ''
            });
            const [imageFile, setImageFile] = useState(null);
            const [imageName, setImageName] = useState('');
            const [dialog, setDialog] = useState({ open: false, message: '', type: 'alert', onConfirm: null });

            const openAlert = (message) => setDialog({ open: true, message, type: 'alert', onConfirm: null });
            const openConfirm = (message, onConfirm) => setDialog({ open: true, message, type: 'confirm', onConfirm });
            const closeDialog = () => setDialog({ open: false, message: '', type: 'alert', onConfirm: null });

            useEffect(() => {
                // Only fetch protected data when authenticated
                if (isAuthenticated) {
                    fetchItems();
                    fetchRooms();
                    fetchCategories();
                }
                // update auth state in case token was set in another tab
                const onStorage = () => setIsAuthenticated(!!localStorage.getItem('access_token'));
                window.addEventListener('storage', onStorage);
                return () => window.removeEventListener('storage', onStorage);
            }, [isAuthenticated]);

            // compute return URL param for login/signup (encode current path+search)
            const nextParam = encodeURIComponent(window.location.pathname + window.location.search);

            // Clear all app state (used when logging out)
            const clearAppState = () => {
                setItems([]);
                setRooms([]);
                setCategories([]);
                setSearchResults([]);
                setFilteredItems([]);
                setItemForm({ name: '', category: '', room: '', cupboard: '', shelf: '', loft: '', inside_items: '', notes: '', image_name: '' });
                setImageFile(null);
                setImageName('');
                setEditingItem(null);
                setShowAddItem(false);
                setSelectedRoom(null);
                setSelectedCategory(null);
                setStats({ total: 0, categories: {} });
                setNotification(null);
            };

            useEffect(() => {
                calculateStats();
            }, [items]);

            // If a focus param is present in the URL, navigate to All Items and scroll/highlight the item
            useEffect(() => {
                try {
                    const params = new URLSearchParams(window.location.search);
                    const focus = params.get('focus');
                    if (!focus) return;
                    // ensure the All Items tab is active
                    setActiveTab('all');
                    setViewMode('all');
                    // after a short delay (allow items to render), find the DOM element and scroll into view
                    setTimeout(() => {
                        const el = document.querySelector(`[data-item-id="${focus}"]`);
                        if (el) {
                            el.scrollIntoView({ behavior: 'smooth', block: 'center' });
                            // temporary highlight
                            const old = el.style.boxShadow;
                            el.style.boxShadow = '0 0 0 4px rgba(99,102,241,0.35)';
                            setTimeout(() => { el.style.boxShadow = old; }, 3000);
                            // open edit modal for the focused item (if present in items array)
                            try {
                                const found = Array.isArray(items) ? items.find(i => String(i.id) === String(focus)) : null;
                                if (found) {
                                    setEditingItem(found);
                                    setShowAddItem(true);
                                }
                            } catch (e) { console.warn('could not open edit modal for focus', e); }
                        }
                    }, 300);
                } catch (e) { console.warn('focus handling failed', e); }
            }, [items]);

            const calculateStats = () => {
                const cats = {};
                // Defensive: ensure items is an array before iterating
                if (Array.isArray(items)) {
                    items.forEach(item => {
                        if (item && item.category) {
                            cats[item.category] = (cats[item.category] || 0) + 1;
                        }
                    });
                    setStats({ total: items.length, categories: cats });
                } else {
                    // If items is not an array (e.g., API returned an error HTML/object), reset safely
                    console.warn('calculateStats: items is not an array', items);
                    setStats({ total: 0, categories: {} });
                }
            };

            const showNotification = (message, type = 'success') => {
                setNotification({ message, type });
                setTimeout(() => setNotification(null), 3000);
            };

            const fetchItems = async () => {
                try {
                    const response = await fetch(`${API_BASE_URL}/items/`, { headers: getAuthHeaders(false) });
                    if (!response.ok) {
                        const text = await response.text().catch(() => '');
                        console.error('fetchItems failed', response.status, text);
                        setItems([]);
                        showNotification('Failed to fetch items (server returned ' + response.status + ')', 'error');
                        return;
                    }
                    const data = await response.json();
                    if (!Array.isArray(data)) {
                        console.warn('fetchItems: server returned non-array', data);
                        setItems([]);
                    } else {
                        setItems(data);
                    }
                } catch (error) {
                    showNotification('Failed to fetch items', 'error');
                }
            };

            const fetchRooms = async () => {
                try {
                    const response = await fetch(`${API_BASE_URL}/rooms/list`, { headers: getAuthHeaders(false) });
                    if (!response.ok) {
                        console.error('fetchRooms failed', response.status);
                        setRooms([]);
                        return;
                    }
                    const data = await response.json();
                    if (!Array.isArray(data)) {
                        console.warn('fetchRooms: server returned non-array', data);
                        setRooms([]);
                    } else {
                        setRooms(data);
                    }
                } catch (error) {
                    console.error('Failed to fetch rooms');
                }
            };

            const fetchCategories = async () => {
                try {
                    const response = await fetch(`${API_BASE_URL}/categories/list`, { headers: getAuthHeaders(false) });
                    if (!response.ok) {
                        console.error('fetchCategories failed', response.status);
                        setCategories([]);
                        return;
                    }
                    const data = await response.json();
                    if (!Array.isArray(data)) {
                        console.warn('fetchCategories: server returned non-array', data);
                        setCategories([]);
                    } else {
                        setCategories(data);
                    }
                } catch (error) {
                    console.error('Failed to fetch categories');
                }
            };

            const handleSearch = async () => {
                if (!searchTerm.trim()) {
                    showNotification('Please enter a search term', 'error');
                    return;
                }
                try {
                    const response = await fetch(`${API_BASE_URL}/search/?q=${encodeURIComponent(searchTerm)}&mode=text`, { headers: getAuthHeaders(false) });
                    const data = await response.json();
                    setSearchResults(data);
                    if (data.length === 0) {
                        showNotification('No items found', 'error');
                    } else {
                        showNotification(`Found ${data.length} item(s)`, 'success');
                    }
                } catch (error) {
                    showNotification('Search failed', 'error');
                }
            };

            const handleRoomClick = async (roomName) => {
                setSelectedRoom(roomName);
                setViewMode('room-detail');
                try {
                    const response = await fetch(`${API_BASE_URL}/items/by-room/${encodeURIComponent(roomName)}`, { headers: getAuthHeaders(false) });
                    const data = await response.json();
                    setFilteredItems(data);
                } catch (error) {
                    showNotification('Failed to load room items', 'error');
                }
            };

            const handleCategoryClick = async (categoryName) => {
                setSelectedCategory(categoryName);
                setViewMode('category-detail');
                try {
                    const response = await fetch(`${API_BASE_URL}/items/by-category/${encodeURIComponent(categoryName)}`, { headers: getAuthHeaders(false) });
                    const data = await response.json();
                    setFilteredItems(data);
                } catch (error) {
                    showNotification('Failed to load category items', 'error');
                }
            };

            const handleAddItem = async (e) => {
                e.preventDefault();
                // Validate required fields
                if (!itemForm.name.trim()) {
                    showNotification('Please enter an item name', 'error');
                    return;
                }
                if (!itemForm.room.trim()) {
                    showNotification('Please select a room', 'error');
                    return;
                }
                try {
                    const response = await fetch(`${API_BASE_URL}/items/`, {
                        method: 'POST',
                        headers: getAuthHeaders(true),
                        body: JSON.stringify(itemForm)
                    });
                    if (response.ok) {
                        const created = await response.json();
                        // if an image was selected, upload it for the created item
                        if (imageFile) {
                            try {
                                const form = new FormData();
                                form.append('file', imageFile, imageFile.name);
                                if (imageName) form.append('image_name', imageName);
                                const up = await fetch(`${API_BASE_URL}/items/${created.id}/upload-image`, {
                                    method: 'POST',
                                    headers: getAuthHeaders(false),
                                    body: form
                                });
                                if (!up.ok) console.warn('Image upload failed');
                            } catch (err) {
                                console.error('Image upload error', err);
                            }
                        }
                        showNotification('Item added successfully!');
                        setShowAddItem(false);
                        // reset form and image fields
                        setItemForm({ name: '', category: '', room: '', cupboard: '', shelf: '', loft: '', inside_items: '', notes: '', image_name: '' });
                        setImageFile(null);
                        setImageName('');
                        fetchItems();
                        fetchRooms();
                        fetchCategories();
                    }
                } catch (error) {
                    showNotification('Failed to add item', 'error');
                }
            };

            const handleUpdateItem = async (e) => {
                e.preventDefault();
                // Validate required fields
                if (!itemForm.name.trim()) {
                    showNotification('Please enter an item name', 'error');
                    return;
                }
                if (!itemForm.room.trim()) {
                    showNotification('Please select a room', 'error');
                    return;
                }
                try {
                    const response = await fetch(`${API_BASE_URL}/items/${editingItem.id}`, {
                        method: 'PUT',
                        headers: getAuthHeaders(true),
                        body: JSON.stringify(itemForm)
                    });
                    if (response.ok) {
                        const updated = await response.json();
                        // if new image selected, upload it
                        if (imageFile) {
                            try {
                                const form = new FormData();
                                form.append('file', imageFile, imageFile.name);
                                if (imageName) form.append('image_name', imageName);
                                const up = await fetch(`${API_BASE_URL}/items/${updated.id}/upload-image`, {
                                    method: 'POST',
                                    headers: getAuthHeaders(false),
                                    body: form
                                });
                                if (!up.ok) console.warn('Image upload failed');
                            } catch (err) {
                                console.error('Image upload error', err);
                            }
                        }
                        showNotification('Item updated successfully!');
                        setEditingItem(null);
                        // reset includes loft, inside_items, and image_name
                        setItemForm({ name: '', category: '', room: '', cupboard: '', shelf: '', loft: '', inside_items: '', notes: '', image_name: '' });
                        setImageFile(null);
                        setImageName('');
                        fetchItems();
                        fetchRooms();
                        fetchCategories();
                        if (searchResults.length > 0) handleSearch();
                        if (selectedRoom) handleRoomClick(selectedRoom);
                        if (selectedCategory) handleCategoryClick(selectedCategory);
                    }
                } catch (error) {
                    showNotification('Failed to update item', 'error');
                }
            };

            const handleDeleteItem = async (id) => {
                openConfirm('Are you sure you want to delete this item?', async () => {
                    try {
                        const response = await fetch(`${API_BASE_URL}/items/${id}`, {
                            method: 'DELETE',
                            headers: getAuthHeaders(false)
                        });
                        if (response.ok) {
                            showNotification('Item deleted successfully!');
                            fetchItems();
                            fetchRooms();
                            fetchCategories();
                            setSearchResults(prev => Array.isArray(prev) ? prev.filter(item => item.id !== id) : []);
                            setFilteredItems(prev => Array.isArray(prev) ? prev.filter(item => item.id !== id) : []);
                        } else {
                            showNotification('Failed to delete item', 'error');
                        }
                    } catch (error) {
                        showNotification('Failed to delete item', 'error');
                    } finally {
                        closeDialog();
                    }
                });
            };

            const startEditItem = (item) => {
                setEditingItem(item);
                // include loft and inside_items when loading into edit form
                setItemForm({
                    name: item.name,
                    category: item.category || '',
                    room: item.room,
                    cupboard: item.cupboard || '',
                    shelf: item.shelf || '',
                    loft: item.loft || '',
                    inside_items: item.inside_items || '',
                    notes: item.notes || '',
                    image_name: item.image_name || ''
                });
                setImageName(item.image_name || '');
            };

            const goToHome = () => {
                setActiveTab('search');
                setViewMode('all');
                setSearchResults([]);
                setSearchTerm('');
            };

            const getCategoryColor = (category) => {
                const colors = {
                    'Luggage': 'from-purple-500 to-pink-500',
                    'Electronics': 'from-blue-500 to-cyan-500',
                    'Document': 'from-yellow-500 to-orange-500',
                    'Clothing': 'from-pink-500 to-rose-500',
                    'Kitchen': 'from-green-500 to-emerald-500',
                    'Tools': 'from-orange-500 to-red-500',
                    'Books': 'from-indigo-500 to-purple-500',
                    'Toys': 'from-cyan-500 to-blue-500',
                    'Travel Items': 'from-blue-600 to-teal-500',
                    {/* Animated floating glass orbs */ }
                    <div className="absolute top-20 left-20 w-40 h-40 glass-effect-colored rounded-full opacity-30 animate-float" style={{ background: 'rgba(236, 72, 153, 0.4)' }}></div>
                    <div className="absolute bottom-32 right-32 w-52 h-52 glass-effect-colored rounded-full opacity-25 animate-float" style={{ background: 'rgba(139, 92, 246, 0.4)', animationDelay: '1s' }}></div>
                    <div className="absolute top-1/3 right-20 w-32 h-32 glass-effect-colored rounded-full opacity-20 animate-float" style={{ background: 'rgba(59, 130, 246, 0.3)', animationDelay: '2s' }}></div>

                    <div className="glass-effect-colored rounded-3xl p-16 max-w-2xl w-full text-center animate-bounce-in relative z-10" style={{ background: 'linear-gradient(135deg, rgba(236, 72, 153, 0.2) 0%, rgba(139, 92, 246, 0.2) 50%, rgba(59, 130, 246, 0.15) 100%)' }}>
                        <div className="flex items-center justify-center mb-8">
                            <a href="/" className="inline-flex items-center gap-4 text-center no-underline cursor-pointer hover:opacity-90 transition-opacity group">
                                <div className="relative group animate-float">
                                    <div className="absolute inset-0 bg-gradient-to-br from-pink-500 via-purple-500 to-blue-500 rounded-3xl blur-2xl opacity-60 group-hover:opacity-80 transition-opacity animate-glow"></div>
                                    <div className="relative bg-gradient-to-br from-pink-400 via-purple-500 to-blue-500 p-6 rounded-3xl shadow-2xl">
                                        <Home className="text-white" size={48} />
                                    </div>
                                </div>
                                <span className="text-4xl font-black bg-gradient-to-r from-pink-300 via-purple-300 to-blue-300 bg-clip-text text-transparent drop-shadow-lg">Home Inventory</span>
                            </a>
                        </div>
                        <h2 className="text-4xl font-black text-white/90 mb-4 drop-shadow-lg">Welcome to your space üåü</h2>
                        <p className="text-white/70 mb-10 text-lg font-semibold drop-shadow-md">Organize with liquid glass style</p>
                        <div className="flex flex-col sm:flex-row justify-center gap-4">
                            <a href={`/auth/login-page?next=${nextParam}`} className="px-8 py-4 text-white rounded-2xl font-black text-lg hover:shadow-2xl hover:scale-105 transition-all duration-300 shadow-lg backdrop-blur-lg"
                                style={{ background: 'linear-gradient(135deg, rgba(236, 72, 153, 0.8) 0%, rgba(139, 92, 246, 0.8) 100%)', border: '1.5px solid rgba(255, 255, 255, 0.3)' }}>
                                Sign In ‚ú®
                            </a>
                            <a href={`/auth/signup-page?next=${nextParam}`} className="px-8 py-4 text-white rounded-2xl font-black text-lg hover:shadow-2xl hover:scale-105 transition-all duration-300 shadow-lg backdrop-blur-lg"
                                style={{ background: 'rgba(59, 130, 246, 0.6)', border: '1.5px solid rgba(255, 255, 255, 0.4)' }}>
                                Create Account üöÄ
                            </a>
                        </div>
                        <p className="text-sm text-white/60 mt-8 font-semibold drop-shadow-md">New here? Sign up. Already have an account? Sign in.</p>
                    </div>
                </div >
            );
        }

        return (
            <div className="min-h-screen">
                {notification && (
                    <div className={`fixed top-6 right-6 px-8 py-4 rounded-2xl shadow-xl z-50 animate-slide-in font-black text-lg border ${notification.type === 'success'
                        ? 'bg-gradient-to-r from-emerald-400 to-teal-500 text-white border-emerald-200 shadow-emerald-500/50'
                        : 'bg-gradient-to-r from-red-400 to-pink-500 text-white border-red-200 shadow-red-500/50'
                        }`}>
                        {notification.type === 'success' ? '‚úì ' : '‚ö† '}{notification.message}
                    </div>
                )}

                <div className="glass-effect-colored sticky top-0 z-40 shadow-lg" style={{ background: 'linear-gradient(135deg, rgba(236, 72, 153, 0.15) 0%, rgba(139, 92, 246, 0.15) 100%)', backdropFilter: 'blur(40px)' }}>
                    <div className="max-w-7xl mx-auto px-6 py-6">
                        <div className="flex items-center justify-between flex-wrap gap-6">
                            <a href="/" className="flex items-center gap-4 cursor-pointer hover:opacity-90 transition-opacity group" >
                                <div className="relative group-hover:animate-float">
                                    <div className="absolute inset-0 bg-gradient-to-br from-pink-500 via-purple-500 to-blue-500 rounded-3xl blur-2xl opacity-40 group-hover:opacity-60 transition-opacity animate-glow"></div>
                                    <div className="relative bg-gradient-to-br from-pink-400 via-purple-500 to-blue-500 p-4 rounded-3xl shadow-xl">
                                        <Home className="text-white" size={40} />
                                    </div>
                                </div>
                                <div>
                                    <h1 className="text-4xl font-black bg-gradient-to-r from-pink-300 via-purple-300 to-blue-300 bg-clip-text text-transparent drop-shadow-lg">
                                        Home Inventory
                                    </h1>
                                    <p className="text-white/70 mt-1 font-bold text-sm drop-shadow-md">Organize. Find. Manage.</p>
                                </div>
                            </a>
                            <div className="flex items-center gap-4">
                                {isAuthenticated ? (
                                    <>
                                        <button
                                            onClick={() => setShowAddItem(true)}
                                            className="group relative flex items-center gap-3 text-white px-8 py-4 rounded-2xl hover:shadow-2xl hover:scale-105 transition-all duration-300 font-black text-lg overflow-hidden shadow-lg"
                                            style={{ background: 'linear-gradient(135deg, rgba(236, 72, 153, 0.7) 0%, rgba(139, 92, 246, 0.7) 100%)', border: '1.5px solid rgba(255, 255, 255, 0.3)' }}
                                        >
                                            <div className="absolute inset-0 bg-gradient-to-br from-pink-500 to-purple-600 opacity-0 group-hover:opacity-100 transition-opacity"></div>
                                            <Plus size={26} className="relative z-10" />
                                            <span className="relative z-10 hidden sm:inline">Add Item</span>
                                        </button>
                                        <button
                                            onClick={() => {
                                                localStorage.removeItem('access_token');
                                                clearAppState();
                                                setIsAuthenticated(false);
                                                showNotification('See you soon!', 'success');
                                            }}
                                            className="px-6 py-4 text-white rounded-2xl font-black hover:shadow-xl transition-all duration-300 hover:scale-105 shadow-lg backdrop-blur-lg"
                                            style={{ background: 'rgba(239, 68, 68, 0.6)', border: '1.5px solid rgba(255, 255, 255, 0.2)' }}
                                        >
                                            Logout
                                        </button>
                                    </>
                                ) : (
                                    <div className="flex items-center gap-3">
                                        <a href={`/auth/login-page?next=${nextParam}`} className="inline-flex items-center gap-2 text-white px-6 py-3 rounded-2xl font-black transition-all duration-300 shadow-lg hover:shadow-xl hover:scale-105 backdrop-blur-lg"
                                            style={{ background: 'rgba(255, 255, 255, 0.2)', border: '1.5px solid rgba(255, 255, 255, 0.3)' }}>Sign In</a>
                                        <a href={`/auth/signup-page?next=${nextParam}`} className="inline-flex items-center gap-2 text-white px-6 py-3 rounded-2xl font-black transition-all duration-300 shadow-lg hover:shadow-xl hover:scale-105 backdrop-blur-lg"
                                            style={{ background: 'linear-gradient(135deg, rgba(139, 92, 246, 0.7) 0%, rgba(59, 130, 246, 0.7) 100%)', border: '1.5px solid rgba(255, 255, 255, 0.3)' }}>Sign Up</a>
                                    </div>
                                )}
                            </div>
                        </div>

                        {/* Stats */}
                        <div className="grid grid-cols-2 md:grid-cols-4 gap-4 mt-8">
                            <div className="glass-effect-colored rounded-2xl p-5 shadow-lg hover:shadow-2xl transition-all duration-300" style={{ background: 'linear-gradient(135deg, rgba(236, 72, 153, 0.2) 0%, rgba(236, 72, 153, 0.1) 100%)', border: '1.5px solid rgba(255, 255, 255, 0.2)' }}>
                                <p className="text-sm font-black text-white/70">üì¶ Items</p>
                                <p className="text-4xl font-black mt-2 bg-gradient-to-r from-pink-300 to-pink-200 bg-clip-text text-transparent">{stats.total}</p>
                            </div>
                            <div className="glass-effect-colored rounded-2xl p-5 shadow-lg hover:shadow-2xl transition-all duration-300" style={{ background: 'linear-gradient(135deg, rgba(139, 92, 246, 0.2) 0%, rgba(139, 92, 246, 0.1) 100%)', border: '1.5px solid rgba(255, 255, 255, 0.2)' }}>
                                <p className="text-sm font-black text-white/70">üè∑Ô∏è Categories</p>
                                <p className="text-4xl font-black mt-2 bg-gradient-to-r from-purple-300 to-purple-200 bg-clip-text text-transparent">{categories.length}</p>
                            </div>
                            <div className="glass-effect-colored rounded-2xl p-5 shadow-lg hover:shadow-2xl transition-all duration-300" style={{ background: 'linear-gradient(135deg, rgba(59, 130, 246, 0.2) 0%, rgba(59, 130, 246, 0.1) 100%)', border: '1.5px solid rgba(255, 255, 255, 0.2)' }}>
                                <p className="text-sm font-black text-white/70">üè† Rooms</p>
                                <p className="text-4xl font-black mt-2 bg-gradient-to-r from-blue-300 to-blue-200 bg-clip-text text-transparent">{rooms.length}</p>
                            </div>
                            <div className="glass-effect-colored rounded-2xl p-5 shadow-lg hover:shadow-2xl transition-all duration-300" style={{ background: 'linear-gradient(135deg, rgba(236, 72, 153, 0.2) 0%, rgba(59, 130, 246, 0.2) 100%)', border: '1.5px solid rgba(255, 255, 255, 0.2)' }}>
                                <p className="text-sm font-black text-white/70">üîç Results</p>
                                <p className="text-4xl font-black mt-2 bg-gradient-to-r from-pink-300 via-purple-300 to-blue-300 bg-clip-text text-transparent">{searchResults.length}</p>
                            </div>
                        </div>
                    </div>
                </div>

                <div className="max-w-7xl mx-auto px-6 py-8">
                    <div className="flex gap-4 mb-8 glass-effect-colored p-2 rounded-2xl shadow-lg" style={{ background: 'linear-gradient(135deg, rgba(236, 72, 153, 0.15) 0%, rgba(139, 92, 246, 0.15) 100%)', border: '1.5px solid rgba(255, 255, 255, 0.2)' }}>
                        <button
                            onClick={() => { setActiveTab('search'); setViewMode('all'); }}
                            className={`flex-1 px-8 py-4 rounded-xl font-black transition-all duration-300 text-lg ${activeTab === 'search'
                                ? 'text-white shadow-lg'
                                : 'text-white/60 hover:text-white/80'
                                }`}
                            style={activeTab === 'search' ? { background: 'linear-gradient(135deg, rgba(236, 72, 153, 0.7) 0%, rgba(139, 92, 246, 0.7) 100%)' } : {}}
                        >
                            <div className="flex items-center justify-center gap-3">
                                <Search size={24} />
                                Search
                            </div>
                        </button>
                        <button
                            onClick={() => { setActiveTab('all'); setViewMode('all'); }}
                            className={`flex-1 px-8 py-4 rounded-xl font-black transition-all duration-300 text-lg ${activeTab === 'all'
                                ? 'text-white shadow-lg'
                                : 'text-white/60 hover:text-white/80'
                                }`}
                            style={activeTab === 'all' ? { background: 'linear-gradient(135deg, rgba(59, 130, 246, 0.7) 0%, rgba(139, 92, 246, 0.7) 100%)' } : {}}
                        >
                            <div className="flex items-center justify-center gap-3">
                                <Package size={24} />
                                All Items
                                <span className="ml-1 px-3 py-1 bg-white/30 text-white rounded-full text-sm font-black">
                                    {items.length}
                                </span>
                            </div>
                        </button>
                    </div>

                    {activeTab === 'search' && (
                        <div>
                            <div className="glass-effect-colored rounded-3xl shadow-lg p-8 mb-8" style={{ background: 'linear-gradient(135deg, rgba(139, 92, 246, 0.15) 0%, rgba(59, 130, 246, 0.15) 100%)', border: '1.5px solid rgba(255, 255, 255, 0.2)' }}>
                                <div className="flex gap-4 flex-wrap">
                                    <div className="flex-1 relative min-w-64">
                                        <Search className="absolute left-5 top-1/2 transform -translate-y-1/2 text-pink-400" size={28} />
                                        <input
                                            type="text"
                                            value={searchTerm}
                                            onChange={(e) => setSearchTerm(e.target.value)}
                                            onKeyPress={(e) => e.key === 'Enter' && handleSearch()}
                                            placeholder="Search by name, room, category..."
                                            className="w-full pl-16 pr-6 py-5 text-white placeholder-white/50 rounded-2xl focus:ring-4 focus:ring-pink-400/50 focus:border-pink-400 text-lg font-bold transition-all shadow-lg"
                                            style={{ background: 'rgba(255, 255, 255, 0.15)', border: '1.5px solid rgba(255, 255, 255, 0.2)' }}
                                        />
                                    </div>
                                    <button
                                        onClick={handleSearch}
                                        className="px-10 py-5 text-white rounded-2xl hover:shadow-2xl hover:scale-105 transition-all duration-300 font-black text-lg shadow-lg"
                                        style={{ background: 'linear-gradient(135deg, rgba(236, 72, 153, 0.7) 0%, rgba(139, 92, 246, 0.7) 100%)', border: '1.5px solid rgba(255, 255, 255, 0.3)' }}
                                    >
                                        üîç Search
                                    </button>
                                </div>
                            </div>

                            {searchResults.length > 0 && (
                                <div>
                                    <h2 className="text-4xl font-black text-white/90 mb-8 flex items-center gap-4 drop-shadow-lg">
                                        <div className="h-10 w-2 bg-gradient-to-b from-pink-400 to-purple-400 rounded-full shadow-lg"></div>
                                        <span className="bg-gradient-to-r from-pink-300 via-purple-300 to-blue-300 bg-clip-text text-transparent">Search Results</span>
                                        <span className="text-2xl font-black bg-gradient-to-r from-pink-300 to-purple-300 bg-clip-text text-transparent">({searchResults.length})</span>
                                    </h2>
                                    <div className="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
                                        {searchResults.map(item => (
                                            <ItemCard key={item.id} item={item} />
                                        ))}
                                    </div>
                                </div>
                            )}
                        </div>
                    )}

                    {activeTab === 'all' && (
                        <div>
                            {viewMode === 'all' && (
                                <div>
                                    <h2 className="text-4xl font-black text-white mb-8 flex items-center gap-4">
                                        <div className="h-10 w-2 bg-gradient-to-b from-pink-400 to-purple-400 rounded-full"></div>
                                        <span className="bg-gradient-to-r from-pink-400 to-purple-400 bg-clip-text text-transparent">Explore Your Stuff</span>
                                    </h2>

                                    <div className="grid grid-cols-1 md:grid-cols-2 gap-6 mb-12">
                                        {/* Rooms Card */}
                                        <div
                                            onClick={() => setViewMode('rooms')}
                                            className="glass-effect rounded-3xl p-8 cursor-pointer hover:shadow-2xl hover:scale-105 transition-all duration-300 border-2 border-purple-400/50 group backdrop-blur-md"
                                        >
                                            <div className="flex items-center justify-between mb-6">
                                                <div className="flex items-center gap-4">
                                                    <div className="bg-gradient-to-br from-blue-500 to-cyan-500 p-4 rounded-2xl shadow-lg group-hover:scale-125 transition-transform">
                                                        <Home className="text-white" size={36} />
                                                    </div>
                                                    <div>
                                                        <h3 className="text-2xl font-black text-white">By Rooms</h3>
                                                        <p className="text-gray-300 font-bold">{rooms.length} rooms</p>
                                                    </div>
                                                </div>
                                                <ChevronRight size={36} className="text-gray-400 group-hover:text-cyan-400 group-hover:translate-x-2 transition-all" />
                                            </div>
                                            <div className="flex flex-wrap gap-2 mt-4">
                                                {rooms.slice(0, 3).map(room => (
                                                    <span key={room.name} className="px-4 py-2 bg-blue-500/30 text-blue-100 rounded-full text-sm font-bold border border-blue-400/50">
                                                        {room.name} ({room.count})
                                                    </span>
                                                ))}
                                                {rooms.length > 3 && (
                                                    <span className="px-4 py-2 bg-white/10 text-gray-300 rounded-full text-sm font-bold border border-white/20">
                                                        +{rooms.length - 3} more
                                                    </span>
                                                )}
                                            </div>
                                        </div>

                                        {/* Categories Card */}
                                        <div
                                            onClick={() => setViewMode('categories')}
                                            className="glass-effect rounded-3xl p-8 cursor-pointer hover:shadow-2xl hover:scale-105 transition-all duration-300 border-2 border-purple-400/50 group backdrop-blur-md"
                                        >
                                            <div className="flex items-center justify-between mb-6">
                                                <div className="flex items-center gap-4">
                                                    <div className="bg-gradient-to-br from-purple-500 to-pink-500 p-4 rounded-2xl shadow-lg group-hover:scale-125 transition-transform">
                                                        <Tag className="text-white" size={36} />
                                                    </div>
                                                    <div>
                                                        <h3 className="text-2xl font-black text-white">By Categories</h3>
                                                        <p className="text-gray-300 font-bold">{categories.length} categories</p>
                                                    </div>
                                                </div>
                                                <ChevronRight size={36} className="text-gray-400 group-hover:text-pink-400 group-hover:translate-x-2 transition-all" />
                                            </div>
                                            <div className="flex flex-wrap gap-2 mt-4">
                                                {categories.slice(0, 3).map(cat => (
                                                    <span key={cat.name} className={`px-4 py-2 text-white rounded-full text-sm font-bold bg-gradient-to-r ${getCategoryColor(cat.name)} border border-white/20`}>
                                                        {getCategoryIcon(cat.name)} {cat.name} ({cat.count})
                                                    </span>
                                                ))}
                                                {categories.length > 3 && (
                                                    <span className="px-4 py-2 bg-white/10 text-gray-300 rounded-full text-sm font-bold border border-white/20">
                                                        +{categories.length - 3} more
                                                    </span>
                                                )}
                                            </div>
                                        </div>
                                    </div>

                                    <h2 className="text-4xl font-black text-white mb-8 flex items-center gap-4 mt-12">
                                        <div className="h-10 w-2 bg-gradient-to-b from-pink-400 to-purple-400 rounded-full"></div>
                                        <span className="bg-gradient-to-r from-pink-400 to-purple-400 bg-clip-text text-transparent">All Items</span>
                                    </h2>
                                    {items.length === 0 ? (
                                        <div className="glass-effect rounded-3xl p-16 text-center border-2 border-purple-400/50 backdrop-blur-md">
                                            <Package size={100} className="mx-auto text-purple-400 mb-6 opacity-50" />
                                            <p className="text-3xl font-black text-white mb-4">No items yet! üì≠</p>
                                            <p className="text-gray-300 mb-8 font-bold text-lg">Start adding items to your inventory</p>
                                            <button
                                                onClick={() => setShowAddItem(true)}
                                                className="inline-flex items-center gap-3 bg-gradient-to-r from-pink-500 to-purple-600 text-white px-10 py-5 rounded-2xl hover:shadow-2xl hover:scale-110 transition-all duration-300 font-black text-xl border border-pink-300/50"
                                            >
                                                <Plus size={28} />
                                                Add First Item
                                            </button>
                                        </div>
                                    ) : (
                                        <div className="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
                                            {items.map(item => (
                                                <ItemCard key={item.id} item={item} />
                                            ))}
                                        </div>
                                    )}
                                </div>
                            )}

                            {viewMode === 'rooms' && (
                                <div>
                                    <button
                                        onClick={() => setViewMode('all')}
                                        className="flex items-center gap-2 px-6 py-3 bg-white rounded-xl shadow-md hover:shadow-lg transition-all mb-6 font-bold text-gray-700"
                                    >
                                        <ArrowLeft size={20} />
                                        Back to All Items
                                    </button>
                                    <h2 className="text-3xl font-black text-gray-800 mb-6 flex items-center gap-4">
                                        <div className="h-10 w-2 bg-gradient-to-b from-indigo-600 to-purple-600 rounded-full"></div>
                                        All Rooms
                                    </h2>
                                    <div className="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
                                        {rooms.map(room => (
                                            <div
                                                key={room.name}
                                                onClick={() => handleRoomClick(room.name)}
                                                className="glass-effect rounded-2xl p-6 cursor-pointer hover:shadow-2xl hover:scale-105 transition-all duration-300 border-2 border-white group"
                                            >
                                                <div className="flex items-center justify-between">
                                                    <div className="flex items-center gap-3">
                                                        <div className="bg-gradient-to-br from-indigo-500 to-purple-500 p-3 rounded-xl">
                                                            <Home className="text-white" size={24} />
                                                        </div>
                                                        <div>
                                                            <h3 className="text-xl font-bold text-white/90 group-hover:text-indigo-300 transition-colors">{room.name}</h3>
                                                            <p className="text-sm text-white/70 font-medium">{room.count} items</p>
                                                        </div>
                                                    </div>
                                                    <ChevronRight size={24} className="text-gray-400 group-hover:text-indigo-600 group-hover:translate-x-2 transition-all" />
                                                </div>
                                            </div>
                                        ))}
                                    </div>
                                </div>
                            )}

                            {viewMode === 'categories' && (
                                <div>
                                    <button
                                        onClick={() => setViewMode('all')}
                                        className="flex items-center gap-2 px-6 py-3 bg-white rounded-xl shadow-md hover:shadow-lg transition-all mb-6 font-bold text-gray-700"
                                    >
                                        <ArrowLeft size={20} />
                                        Back to All Items
                                    </button>
                                    <h2 className="text-3xl font-black text-gray-800 mb-6 flex items-center gap-4">
                                        <div className="h-10 w-2 bg-gradient-to-b from-purple-600 to-pink-600 rounded-full"></div>
                                        All Categories
                                    </h2>
                                    <div className="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
                                        {categories.map(cat => (
                                            <div
                                                key={cat.name}
                                                onClick={() => handleCategoryClick(cat.name)}
                                                className="glass-effect rounded-2xl p-6 cursor-pointer hover:shadow-2xl hover:scale-105 transition-all duration-300 border-2 border-white group"
                                            >
                                                <div className="flex items-center justify-between">
                                                    <div className="flex items-center gap-3">
                                                        <div className={`bg-gradient-to-br ${getCategoryColor(cat.name)} p-3 rounded-xl text-white text-2xl`}>
                                                            {getCategoryIcon(cat.name)}
                                                        </div>
                                                        <div>
                                                            <h3 className="text-xl font-bold text-white/90 group-hover:text-purple-300 transition-colors">{cat.name}</h3>
                                                            <p className="text-sm text-white/70 font-medium">{cat.count} items</p>
                                                        </div>
                                                    </div>
                                                    <ChevronRight size={24} className="text-gray-400 group-hover:text-purple-600 group-hover:translate-x-2 transition-all" />
                                                </div>
                                            </div>
                                        ))}
                                    </div>
                                </div>
                            )}

                            {viewMode === 'room-detail' && (
                                <div>
                                    <button
                                        onClick={() => setViewMode('rooms')}
                                        className="flex items-center gap-2 px-6 py-3 bg-white rounded-xl shadow-md hover:shadow-lg transition-all mb-6 font-bold text-gray-700"
                                    >
                                        <ArrowLeft size={20} />
                                        Back to Rooms
                                    </button>
                                    <h2 className="text-3xl font-black text-gray-800 mb-6 flex items-center gap-4">
                                        <div className="h-10 w-2 bg-gradient-to-b from-indigo-600 to-purple-600 rounded-full"></div>
                                        {selectedRoom}
                                        <span className="text-xl font-bold text-indigo-600">({filteredItems.length} items)</span>
                                    </h2>
                                    <div className="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
                                        {filteredItems.map(item => (
                                            <ItemCard key={item.id} item={item} />
                                        ))}
                                    </div>
                                </div>
                            )}

                            {viewMode === 'category-detail' && (
                                <div>
                                    <button
                                        onClick={() => setViewMode('categories')}
                                        className="flex items-center gap-2 px-6 py-3 bg-white rounded-xl shadow-md hover:shadow-lg transition-all mb-6 font-bold text-gray-700"
                                    >
                                        <ArrowLeft size={20} />
                                        Back to Categories
                                    </button>
                                    <h2 className="text-3xl font-black text-gray-800 mb-6 flex items-center gap-4">
                                        <div className="h-10 w-2 bg-gradient-to-b from-purple-600 to-pink-600 rounded-full"></div>
                                        <span className="text-2xl">{getCategoryIcon(selectedCategory)}</span>
                                        {selectedCategory}
                                        <span className="text-xl font-bold text-purple-600">({filteredItems.length} items)</span>
                                    </h2>
                                    <div className="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
                                        {filteredItems.map(item => (
                                            <ItemCard key={item.id} item={item} />
                                        ))}
                                    </div>
                                </div>
                            )}
                        </div>
                    )}
                </div>

                {(showAddItem || editingItem) && (
                    <div className="fixed inset-0 bg-black/40 backdrop-blur-xl flex items-center justify-center p-4 z-40 animate-fade-in">
                        <div className="glass-effect-colored rounded-3xl shadow-2xl max-w-2xl w-full max-h-[90vh] overflow-y-auto" style={{ background: 'linear-gradient(135deg, rgba(236, 72, 153, 0.15) 0%, rgba(139, 92, 246, 0.15) 100%)', border: '1.5px solid rgba(255, 255, 255, 0.2)' }}>
                            <div className="sticky top-0 text-white p-8 rounded-t-3xl border-b border-white/20 shadow-lg" style={{ background: 'linear-gradient(135deg, rgba(236, 72, 153, 0.7) 0%, rgba(139, 92, 246, 0.5) 50%, rgba(59, 130, 246, 0.5) 100%)' }}>
                                <div className="flex justify-between items-center">
                                    <h2 className="text-3xl font-black drop-shadow-lg">
                                        {editingItem ? '‚úèÔ∏è Edit Item' : '‚ú® Add New Item'}
                                    </h2>
                                    <button
                                        onClick={() => {
                                            setShowAddItem(false);
                                            setEditingItem(null);
                                            setItemForm({ name: '', category: '', room: '', cupboard: '', shelf: '', loft: '', inside_items: '', notes: '' });
                                        }}
                                        className="p-3 hover:bg-white/30 rounded-2xl transition-all hover:scale-125 font-black"
                                    >
                                        <X size={32} />
                                    </button>
                                </div>
                            </div>
                            <div className="p-8 space-y-6">
                                <div>
                                    <label className="block text-sm font-black text-pink-300 mb-2 uppercase tracking-widest drop-shadow-md">
                                        Item Name *
                                    </label>
                                    <input
                                        type="text"
                                        required
                                        value={itemForm.name}
                                        onChange={(e) => setItemForm({ ...itemForm, name: e.target.value })}
                                        className="w-full px-5 py-4 text-white placeholder-white/50 rounded-2xl focus:ring-4 focus:ring-pink-400/50 focus:border-pink-400 transition-all text-lg font-bold shadow-lg"
                                        style={{ background: 'rgba(255, 255, 255, 0.15)', border: '1.5px solid rgba(255, 255, 255, 0.2)' }}
                                        placeholder="e.g., Red Suitcase, Winter Jacket"
                                    />
                                </div>
                                <div>
                                    <label className="block text-sm font-black text-purple-300 mb-2 uppercase tracking-widest drop-shadow-md">Category</label>
                                    <select
                                        value={itemForm.category}
                                        onChange={(e) => setItemForm({ ...itemForm, category: e.target.value })}
                                        className="w-full px-5 py-4 text-gray-900 rounded-2xl focus:ring-4 focus:ring-purple-400/50 focus:border-purple-400 transition-all text-lg font-bold shadow-lg"
                                        style={{ background: 'rgba(255, 255, 255, 0.15)', border: '1.5px solid rgba(255, 255, 255, 0.2)' }}
                                    >
                                        <option value="">Select a category</option>
                                        <option value="Luggage">üß≥ Luggage</option>
                                        <option value="Electrical">‚ö° Electrical</option>
                                        <option value="Electronics">üíª Electronics</option>
                                        <option value="Document">üìÑ Document</option>
                                        <option value="Clothing">üëï Clothing</option>
                                        <option value="Kitchen">üç≥ Kitchen</option>
                                        <option value="Tools">üîß Tools</option>
                                        <option value="Books">üìö Books</option>
                                        <option value="Toys">üéÆ Toys</option>
                                        <option value="Medical">ü©∫ Medical</option>
                                        <option value="Furniture">ü™ë Furniture</option>
                                        <option value="Stationery">‚úèÔ∏è Stationery</option>
                                        <option value="Accessories">üëú Accessories</option>
                                        <option value="Travel Items">‚úàÔ∏è Travel Items</option>
                                        <option value="Car Accessories">üöó Car Accessories</option>
                                        <option value="Misc">üì¶ Misc</option>
                                    </select>
                                </div>
                                <div>
                                    <label className="block text-sm font-black text-blue-300 mb-2 uppercase tracking-widest drop-shadow-md">Room *</label>
                                    <input
                                        type="text"
                                        required
                                        value={itemForm.room}
                                        onChange={(e) => setItemForm({ ...itemForm, room: e.target.value })}
                                        className="w-full px-5 py-4 text-white placeholder-white/50 rounded-2xl focus:ring-4 focus:ring-blue-400/50 focus:border-blue-400 transition-all text-lg font-bold shadow-lg"
                                        style={{ background: 'rgba(255, 255, 255, 0.15)', border: '1.5px solid rgba(255, 255, 255, 0.2)' }}
                                        placeholder="e.g., Master Bedroom, Living Room"
                                    />
                                </div>
                                <div className="grid grid-cols-3 gap-4">
                                    <div>
                                        <label className="block text-sm font-black text-blue-300 mb-2 uppercase tracking-widest drop-shadow-md">Cupboard</label>
                                        <input
                                            type="text"
                                            value={itemForm.cupboard}
                                            onChange={(e) => setItemForm({ ...itemForm, cupboard: e.target.value })}
                                            className="w-full px-5 py-4 text-white placeholder-white/50 rounded-2xl focus:ring-4 focus:ring-blue-400/50 focus:border-blue-400 transition-all text-lg font-bold shadow-lg"
                                            style={{ background: 'rgba(255, 255, 255, 0.15)', border: '1.5px solid rgba(255, 255, 255, 0.2)' }}
                                            placeholder="e.g., 1st"
                                        />
                                    </div>
                                    <div>
                                        <label className="block text-sm font-black text-purple-300 mb-2 uppercase tracking-widest drop-shadow-md">Shelf</label>
                                        <input
                                            type="text"
                                            value={itemForm.shelf}
                                            onChange={(e) => setItemForm({ ...itemForm, shelf: e.target.value })}
                                            className="w-full px-5 py-4 text-white placeholder-white/50 rounded-2xl focus:ring-4 focus:ring-purple-400/50 focus:border-purple-400 transition-all text-lg font-bold shadow-lg"
                                            style={{ background: 'rgba(255, 255, 255, 0.15)', border: '1.5px solid rgba(255, 255, 255, 0.2)' }}
                                            placeholder="e.g., Top"
                                        />
                                    </div>
                                    <div>
                                        <label className="block text-sm font-black text-pink-300 mb-2 uppercase tracking-widest drop-shadow-md">Loft</label>
                                        <input
                                            type="text"
                                            value={itemForm.loft}
                                            onChange={(e) => setItemForm({ ...itemForm, loft: e.target.value })}
                                            className="w-full px-5 py-4 text-white placeholder-white/50 rounded-2xl focus:ring-4 focus:ring-pink-400/50 focus:border-pink-400 transition-all text-lg font-bold shadow-lg"
                                            style={{ background: 'rgba(255, 255, 255, 0.15)', border: '1.5px solid rgba(255, 255, 255, 0.2)' }}
                                            placeholder="e.g., A"
                                        />
                                    </div>
                                </div>

                                <div>
                                    <label className="block text-sm font-black text-pink-300 mb-2 uppercase tracking-widest drop-shadow-md">Inside Items</label>
                                    <textarea
                                        value={itemForm.inside_items}
                                        onChange={(e) => setItemForm({ ...itemForm, inside_items: e.target.value })}
                                        className="w-full px-5 py-4 text-white placeholder-white/50 rounded-2xl focus:ring-4 focus:ring-pink-400/50 focus:border-pink-400 transition-all text-lg font-bold shadow-lg"
                                        style={{ background: 'rgba(255, 255, 255, 0.15)', border: '1.5px solid rgba(255, 255, 255, 0.2)' }}
                                        rows="4"
                                        placeholder="One item per line"
                                    />
                                    <p className="text-xs text-white/70 mt-2 font-bold drop-shadow-md">Each line becomes a bullet point</p>
                                </div>

                                <h3 className="text-xl font-bold mb-2">{dialog.type === 'confirm' ? 'Confirm' : 'Notice'}</h3>
                                <p className="mb-6 text-sm whitespace-pre-wrap">{dialog.message}</p>
                                <div className="flex justify-end gap-3">
                                    {dialog.type === 'confirm' && (
                                        <button onClick={() => closeDialog()} className="px-4 py-2 rounded-lg font-bold bg-gray-200 text-gray-800">Cancel</button>
                                    )}
                                    <button onClick={() => { if (dialog.onConfirm) { try { dialog.onConfirm(); } catch (e) { console.error(e); } } else { closeDialog(); } }} className="px-4 py-2 rounded-lg font-bold bg-gradient-to-r from-purple-600 to-pink-500 text-white">OK</button>
                                </div>
                            </div>
                        </div>
                )}
                    </div>
                );
        }

                ReactDOM.render(<HomeInventoryApp />, document.getElementById('root'));

                // Floating Image Gallery Button (outside React)
                (function () {
            const btn = document.createElement('button');
                btn.textContent = 'üñºÔ∏è Gallery';
                btn.style.position = 'fixed';
                btn.style.right = '20px';
                btn.style.bottom = '20px';
                btn.style.zIndex = 9999;
                btn.style.padding = '14px 20px';
                btn.style.borderRadius = '20px';
                btn.style.background = 'linear-gradient(135deg,#3b82f6,#8b5cf6)';
                btn.style.color = 'white';
                btn.style.fontWeight = '900';
                btn.style.fontSize = '16px';
                btn.style.boxShadow = '0 10px 30px rgba(59, 130, 246, 0.3)';
                btn.style.cursor = 'pointer';
                btn.style.border = '2px solid rgba(255,255,255,0.4)';
                btn.style.backdropFilter = 'blur(16px)';
                btn.style.transition = 'all 0.3s ease';
                btn.onmouseover = function () {
                    this.style.transform = 'scale(1.08)';
                this.style.boxShadow = '0 15px 40px rgba(59, 130, 246, 0.5)';
            };
                btn.onmouseout = function () {
                    this.style.transform = 'scale(1)';
                this.style.boxShadow = '0 10px 30px rgba(59, 130, 246, 0.3)';
            };
            btn.onclick = async () => {
                // if not logged in, redirect to login page
                const token = localStorage.getItem('access_token');
                if (!token) {
                    window.location.href = '/auth/login-page';
                return;
                }

                const overlay = document.createElement('div');
                overlay.style.position = 'fixed';
                overlay.style.inset = '0';
                overlay.style.background = 'linear-gradient(135deg,rgba(248, 249, 250, 0.7),rgba(232, 233, 240, 0.7))';
                overlay.style.backdropFilter = 'blur(16px)';
                overlay.style.zIndex = 10000;
                overlay.style.overflow = 'auto';
                overlay.style.padding = '28px 18px';
                overlay.style.paddingTop = '60px';

                const inner = document.createElement('div');
                inner.style.maxWidth = '1100px';
                inner.style.margin = '20px auto';
                inner.style.display = 'grid';
                inner.style.gridTemplateColumns = 'repeat(auto-fill,minmax(220px,1fr))';
                inner.style.gap = '16px';
                inner.style.alignItems = 'start';

                overlay.appendChild(inner);

                const localGetCategoryIcon = (category) => {
                    const icons = {
                    'Luggage': 'üß≥',
                'Electronics': 'üíª',
                'Document': 'üìÑ',
                'Clothing': 'üëï',
                'Kitchen': 'üç≥',
                'Tools': 'üîß',
                'Books': 'üìö',
                'Toys': 'üéÆ',
                'Medical': 'ü©∫',
                'Furniture': 'ü™ë',
                'Stationery': '‚úèÔ∏è',
                'Accessories': 'üëú',
                'Misc': 'üì¶',
                'Electrical': '‚ö°'
                    };
                return icons[category] || 'üì¶';
                };

                const closeBtn = document.createElement('button');
                closeBtn.textContent = '‚úï Close';
                closeBtn.style.position = 'fixed';
                closeBtn.style.top = '20px';
                closeBtn.style.right = '20px';
                closeBtn.style.zIndex = 10001;
                closeBtn.style.padding = '12px 18px';
                closeBtn.style.borderRadius = '14px';
                closeBtn.style.background = 'linear-gradient(135deg,#3b82f6,#8b5cf6)';
                closeBtn.style.color = '#fff';
                closeBtn.style.cursor = 'pointer';
                closeBtn.style.fontWeight = '900';
                closeBtn.style.border = '2px solid rgba(255,255,255,0.4)';
                closeBtn.style.fontSize = '14px';
                closeBtn.style.boxShadow = '0 8px 24px rgba(59, 130, 246, 0.3)';
                closeBtn.style.transition = 'all 0.3s ease';
                closeBtn.onmouseover = function () {
                    this.style.transform = 'scale(1.05)';
                };
                closeBtn.onmouseout = function () {
                    this.style.transform = 'scale(1)';
                };
                closeBtn.onclick = () => {
                    try {document.body.removeChild(overlay); } catch (e) { }
                };
                overlay.appendChild(closeBtn);

                const status = document.createElement('div');
                status.style.gridColumn = '1 / -1';
                status.style.color = '#1d1d1d';
                status.style.fontSize = '18px';
                status.style.marginBottom = '8px';
                status.style.fontWeight = '900';
                status.textContent = 'Loading gallery...';
                inner.appendChild(status);

                document.body.appendChild(overlay);

                try {
                    // First, load categories and show category grid. Clicking a category will load images for that category.
                    const resCats = await fetch(`${API_BASE_URL}/categories/list`, {headers: getAuthHeaders(false) });
                if (!resCats.ok) {
                    status.textContent = 'Failed to load categories';
                return;
                    }
                const cats = await resCats.json();
                status.remove();
                if (!Array.isArray(cats) || cats.length === 0) {
                        const no = document.createElement('div');
                no.textContent = 'No categories found. Add items with images to populate the gallery.';
                no.style.color = '#1d1d1d';
                no.style.gridColumn = '1 / -1';
                no.style.fontWeight = '900';
                no.style.fontSize = '16px';
                inner.appendChild(no);
                return;
                    }

                    const renderCategories = (categories) => {
                    inner.innerHTML = '';
                        categories.forEach(cat => {
                            const el = document.createElement('div');
                el.style.background = 'rgba(255, 255, 255, 0.9)';
                el.style.padding = '18px';
                el.style.borderRadius = '16px';
                el.style.display = 'flex';
                el.style.flexDirection = 'column';
                el.style.alignItems = 'flex-start';
                el.style.justifyContent = 'center';
                el.style.border = '2px solid rgba(255, 255, 255, 0.6)';
                el.style.cursor = 'pointer';
                el.onmouseover = function () {this.style.transform = 'scale(1.03)'; this.style.boxShadow = '0 10px 30px rgba(59,130,246,0.12)'; };
                el.onmouseout = function () {this.style.transform = 'scale(1)'; this.style.boxShadow = 'none'; };
                const title = document.createElement('div');
                title.textContent = (cat.name || 'Unnamed') + ' (' + (cat.count || 0) + ')';
                title.style.fontWeight = '900';
                title.style.fontSize = '16px';
                title.style.color = '#1d1d1d';
                title.style.marginBottom = '8px';
                const icon = document.createElement('div');
                icon.textContent = localGetCategoryIcon(cat.name) || 'üì¶';
                icon.style.fontSize = '26px';
                icon.style.marginBottom = '6px';
                el.appendChild(icon);
                el.appendChild(title);
                            el.onclick = () => showImagesForCategory(cat.name);
                inner.appendChild(el);
                        });
                    };

                    const renderImages = (items, imgsAll) => {
                    inner.innerHTML = '';
                if (!Array.isArray(items) || items.length === 0) {
                            const no = document.createElement('div');
                no.textContent = 'No images in this category.';
                no.style.color = '#1d1d1d';
                no.style.gridColumn = '1 / -1';
                no.style.fontWeight = '900';
                no.style.fontSize = '16px';
                inner.appendChild(no);
                const backBtn = document.createElement('button');
                backBtn.textContent = '‚¨ÖÔ∏è Back to categories';
                backBtn.style.gridColumn = '1 / -1';
                backBtn.style.padding = '12px 16px';
                backBtn.style.marginTop = '12px';
                backBtn.style.borderRadius = '12px';
                backBtn.style.cursor = 'pointer';
                backBtn.style.background = 'linear-gradient(135deg,#3b82f6,#8b5cf6)';
                backBtn.style.color = '#fff';
                            backBtn.onclick = () => renderCategories(cats);
                inner.appendChild(backBtn);
                return;
                        }
                        items.forEach(item => {
                            if (!item.image_path) return;
                const el = document.createElement('div');
                el.style.background = 'rgba(255, 255, 255, 0.9)';
                el.style.padding = '10px';
                el.style.borderRadius = '16px';
                el.style.display = 'flex';
                el.style.flexDirection = 'column';
                            img.onclick = () => {showDetail(item); };
                const title = document.createElement('div');
                title.textContent = item.image_name || item.name;
                title.style.marginTop = '10px';
                title.style.fontWeight = '900';
                title.style.color = '#1d1d1d';
                title.style.fontSize = '14px';
                title.style.overflow = 'hidden';
                title.style.textOverflow = 'ellipsis';
                title.style.whiteSpace = 'nowrap';
                el.appendChild(img);
                el.appendChild(title);
                inner.appendChild(el);
                        });
                const back = document.createElement('button');
                back.textContent = '‚¨ÖÔ∏è Back to categories';
                back.style.gridColumn = '1 / -1';
                back.style.padding = '12px 16px';
                back.style.marginTop = '12px';
                back.style.borderRadius = '12px';
                back.style.cursor = 'pointer';
                back.style.background = 'linear-gradient(135deg,#3b82f6,#8b5cf6)';
                back.style.color = '#fff';
                back.style.fontWeight = '900';
                back.style.border = '2px solid rgba(255,255,255,0.4)';
                        back.onclick = () => renderCategories(cats);
                inner.appendChild(back);
                    };

                    const showDetail = (item) => {
                    inner.innerHTML = '';
                const panel = document.createElement('div');
                panel.style.background = 'rgba(255, 255, 255, 0.95)';
                panel.style.padding = '24px';
                panel.style.borderRadius = '20px';
                panel.style.maxWidth = '900px';
                panel.style.margin = '20px auto';
                panel.style.color = '#1d1d1d';
                panel.style.border = '2px solid rgba(255, 255, 255, 0.6)';
                panel.style.backdropFilter = 'blur(32px)';
                panel.style.boxShadow = '0 20px 60px rgba(0, 0, 0, 0.1)';

                const big = document.createElement('img');
                big.src = item.image_path;
                big.style.width = '100%';
                big.style.maxHeight = '520px';
                big.style.objectFit = 'contain';
                big.style.borderRadius = '16px';
                big.style.marginBottom = '20px';
                big.style.boxShadow = '0 10px 30px rgba(0, 0, 0, 0.15)';
                big.style.border = '1px solid rgba(255, 255, 255, 0.5)';
                panel.appendChild(big);

                const title = document.createElement('h2');
                title.textContent = item.image_name || item.name || 'Image';
                title.style.margin = '16px 0 12px';
                title.style.fontSize = '28px';
                title.style.fontWeight = '900';
                title.style.color = '#1d1d1d';
                panel.appendChild(title);

                const meta = document.createElement('div');
                meta.style.display = 'grid';
                meta.style.gridTemplateColumns = '1fr 1fr';
                meta.style.gap = '12px';
                meta.style.marginBottom = '16px';

                        const mk = (label, val) => {
                            const d = document.createElement('div');
                d.style.background = 'rgba(59, 130, 246, 0.05)';
                d.style.padding = '12px';
                d.style.borderRadius = '12px';
                d.style.border = '1px solid rgba(59, 130, 246, 0.08)';
                const l = document.createElement('div');
                l.textContent = label;
                l.style.fontSize = '13px';
                l.style.color = '#3b82f6';
                l.style.fontWeight = '900';
                l.style.textTransform = 'uppercase';
                const v = document.createElement('div');
                v.textContent = val || '-';
                v.style.marginTop = '6px';
                v.style.fontWeight = '900';
                v.style.color = '#1d1d1d';
                d.appendChild(l);
                d.appendChild(v);
                return d;
                        };

                meta.appendChild(mk('Category', item.category));
                meta.appendChild(mk('Room', item.room));
                meta.appendChild(mk('Cupboard', item.cupboard));
                meta.appendChild(mk('Shelf', item.shelf));
                meta.appendChild(mk('Loft', item.loft));
                meta.appendChild(mk('File', item.image_name || item.name));
                panel.appendChild(meta);

                if (item.inside_items) {
                            const ins = document.createElement('div');
                ins.style.marginTop = '16px';
                ins.style.padding = '16px';
                ins.style.background = 'rgba(59, 130, 246, 0.05)';
                ins.style.borderRadius = '12px';
                ins.style.border = '1px solid rgba(59, 130, 246, 0.08)';
                const lbl = document.createElement('div');
                lbl.textContent = 'Inside Items';
                lbl.style.fontWeight = '900';
                lbl.style.color = '#3b82f6';
                lbl.style.marginBottom = '10px';
                lbl.style.fontSize = '14px';
                lbl.style.textTransform = 'uppercase';
                ins.appendChild(lbl);
                const ul = document.createElement('ul');
                ul.style.paddingLeft = '20px';
                ul.style.listStyle = 'none';
                            String(item.inside_items).split('\n').forEach(line => {
                                const t = line && line.trim();
                if (t) {
                                    const li = document.createElement('li');
                li.textContent = '‚úì ' + t.replace(/^[-.\s]+/, '');
                li.style.color = '#1d1d1d';
                li.style.fontWeight = '600';
                li.style.marginBottom = '4px';
                ul.appendChild(li);
                                }
                            });
                ins.appendChild(ul);
                panel.appendChild(ins);
                        }

                if (item.notes) {
                            const notes = document.createElement('div');
                notes.style.marginTop = '16px';
                notes.style.padding = '16px';
                notes.style.background = 'rgba(139, 92, 246, 0.05)';
                notes.style.borderRadius = '12px';
                notes.style.border = '1px solid rgba(139, 92, 246, 0.08)';
                const lbl = document.createElement('div');
                lbl.textContent = 'Notes';
                lbl.style.fontWeight = '900';
                lbl.style.color = '#8b5cf6';
                lbl.style.marginBottom = '8px';
                lbl.style.fontSize = '14px';
                lbl.style.textTransform = 'uppercase';
                notes.appendChild(lbl);
                const p = document.createElement('div');
                p.textContent = item.notes;
                p.style.whiteSpace = 'pre-wrap';
                p.style.color = '#1d1d1d';
                p.style.fontWeight = '600';
                notes.appendChild(p);
                panel.appendChild(notes);
                        }

                const actions = document.createElement('div');
                actions.style.display = 'flex';
                actions.style.gap = '12px';
                actions.style.marginTop = '20px';
                const back = document.createElement('button');
                back.textContent = '‚¨ÖÔ∏è Back';
                back.style.padding = '14px 20px';
                back.style.borderRadius = '14px';
                back.style.cursor = 'pointer';
                back.style.background = 'linear-gradient(135deg,#3b82f6,#8b5cf6)';
                back.style.color = '#fff';
                back.style.fontWeight = '900';
                back.style.border = '2px solid rgba(255,255,255,0.4)';
                back.style.fontSize = '14px';
                back.style.transition = 'all 0.3s ease';
                back.onmouseover = function () {this.style.transform = 'scale(1.05)'; this.style.boxShadow = '0 8px 24px rgba(59, 130, 246, 0.4)'; };
                back.onmouseout = function () {this.style.transform = 'scale(1)'; };
                        back.onclick = () => {renderCategories(cats); };
                actions.appendChild(back);
                panel.appendChild(actions);

                inner.appendChild(panel);
                overlay.scrollTop = 0;
                    };

                    const showImagesForCategory = async (categoryName) => {
                    inner.innerHTML = '';
                const load = document.createElement('div');
                load.textContent = 'Loading images for ' + categoryName + '...';
                load.style.gridColumn = '1 / -1';
                load.style.color = '#1d1d1d';
                load.style.fontWeight = '900';
                inner.appendChild(load);
                try {
                            const resp = await fetch(`${API_BASE_URL}/items/by-category/${encodeURIComponent(categoryName)}`, { headers: getAuthHeaders(false) });
                            const data = await resp.json();
                            // filter only items that have images (Supabase URLs start with https://)
                            const withImages = Array.isArray(data) ? data.filter(it => it && it.image_path && it.image_path.startsWith('https://')) : [];
                            renderImages(withImages, data);
                        } catch (err) {
                            inner.innerHTML = '';
                            const errEl = document.createElement('div');
                            errEl.textContent = 'Failed to load images for category.';
                            errEl.style.color = '#1d1d1d';
                            inner.appendChild(errEl);
                        }
                    };

                    // initial render: show categories
                    renderCategories(cats);
                } catch (err) {
                    status.textContent = 'Error: ' + (err && err.message ? err.message : String(err));
                }
            };
            document.body.appendChild(btn);
        })();
    </script>
</body>

</html>